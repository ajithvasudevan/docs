# TM1637 Seven-Segment Display (4-digit and 6-digit)

!!! failure "This feature is not included in precompiled binaries, except _tasmota*-display.bin_"     

To use this feature (i.e., if you're not using _tasmota*-display.bin_ precompiled binary), you must [compile your build](Compile-your-build) after adding the following to `user_config_override.h`:
```
#ifndef USE_DISPLAY
#define USE_DISPLAY
#endif

#ifndef USE_DISPLAY_TM1637
#define USE_DISPLAY_TM1637
#endif
```
----

TM1637<br>
![TM1637](_media/peripherals/TM1637-front.png)

The **TM1637** display module is a small (~ 10mm high digits) 7-segment, LED-based display unit with 4 or 6 digits. It uses a two-wire I2C-like (but not exactly) protocol for communication with MCUs. 

This module is a great way to add a simple numeric display to any MCU project.
<br><br>
## Features
* The Tasmota support for this module enables the display of numbers (both integers and floats) and basic text. For example, sending the text "22.5^" displays "22.5°"

* Raw segments can also be displayed.

* It is also possible to set brightness (8 levels), clear the display, scroll text, display a rudimentary bar graph, and a Clock (12 hr and 24 hr).

* Additionally, for the TM1638, it allows the onboard LEDs to be toggled using its buttons. Useful STAT messages are also sent when the TM1638 buttons are pressed.
<br><br>
## Configuration

### Wiring
The TM1637 module needs two GPIO pins and a 3.3V-5V power supply. 

| TM1637   | ESP8266 based module |
|---|---|
|CLK   | GPIOx   |
|DIO   | GPIOy 
|VCC   | 3.3V (e.g., _ESP-01_) or 5V (e.g., _Wemos D1 Mini_)
|GND   | GND


### Tasmota Settings 
In Tasmota's **_Configuration -> Configure Module_** page assign:

1. GPIOx to `SSPI SCLK`
2. GPIOy to `SSPI MOSI`


For example, if x=3 and y=4, then the configuration would look like the following:

![TM1637](_media/TM1637-tasmota-config.png)


!!! failure "Note that you need to select the **SSPI** pins and NOT *SPI*" 


Once the GPIO configuration is saved and the ESP8266/ESP32 module restarts, set the Display Model to 15 using the command "DisplayModel 15"

  After this, depending upon your display variant, set your Display Type to 0, 1 or 2 using the command

     "DisplayType 0"  // for the 4-digit TM1637  OR
     "DisplayType 1"  // for the 6-digit TM1637  OR
     "DisplayType 2"  // for the 8-digit TM1638


  After the ESP8266/ESP32 module restarts again, the following "Display" commands can be used from the Tasmota web-console or _MQTT_, and from Tasmota _Rules_.:



## Commands and Usage

 Console/MQTT Commands    | Description                                             | values     |
---------------------|---------------------------------------------------------|------------|
 DisplayType         | Sets the display type to one of TM1637 4-Digit (0), TM1637 6-Digit (1), or TM1638 (8-digit) (2)                              | 0 or 1 or 2
 DisplayClear     | Clears the display  | 
 DisplayNumber     | Clears and then displays number without decimal. command e.g., "DisplayNumber 1234". <br> Control `leading zeros`, `length` and `position`. <br> `leading zeros` can be `1` or `0` (default),<br> `length` can be `1` to `NUM_DIGITS` (4 or 6), <br> `position` can be `0` (left-most) to `NUM_DIGITS` (right-most).  <br> Command example: `DisplayNumber 12, 1, 1, 3`  This will display test |    `num` [, `position`[, `leading_zeros`[, `length`]]]
 DisplayNumberNC | Display integer number as above, but without clearing first. e.g., "DisplayNumberNC 1234". Usage is same as above. | same as above
DisplayFloat | Clears and then displays float (with decimal point)  command e.g., "DisplayFloat 12.34". <br> Control `precision`, `length` and `position`. <br> `precision` can be `0` to `NUM_DIGITS` (default), <br> `length` can be `1` to `NUM_DIGITS` (4 or 6), <br> `position` can be `0` (left-most) to `NUM_DIGITS` (right-most).  <br> Command example: `DisplayFloat 2.48, 1, 1, 2`  This will display `[_2.5_]` | `num`[, `position`[, `precision`[, `length`]]]
DisplayFloatNC | Displays float (with decimal point) as above, but without clearing first. command e.g., "DisplayFloatNC 12.34" | same as above
DisplayBrightness | Set brightness of the display.  Command e.g., "DisplayBrightness 2" | 1 to 8
DisplayRaw | Takes upto `NUM_DIGITS` comma-separated integers (0-255) and displays raw segments. <br> Each number represents a 7-segment digit. Each 8-bit number represents individual segments of a digit. <br> For example, the command `DisplayRaw 0, 4, 255, 255, 255, 255` would display `[8.8.8.8.]` | `position`, `length`,  `num1` [, `num2`[, `num3`[, `num4`[, ...upto `NUM_DIGITS` numbers]]...]
DisplayText | Clears and then displays basic text.  Command e.g., `DisplayText a.b12` <br> Control `length` and `position` of the displayed text. <br> `length` can be `1` to `NUM_DIGITS` , <br> `position` can be `0` (left-most) to `NUM_DIGITS-1` (right-most) <br><br>  A caret(`^`) symbol in the text input is dispayed as the degrees(`°`) symbol. This is useful for displaying Temperature! <br> For example, the command `DisplayText 22.5^` will display `[22.5°]`.  | `text`[, `position`[, `length`]]
DisplayTextNC | Clears first, then displays text. Usage is same as above. | same as above
DisplayScrollText | Displays scrolling text, upto 50 characters. Command example: `DisplayScrollText tasmota is awesome`| text
DisplayScrollDelay | Sets the speed of text scroll. Smaller delay = faster scrolling. | 0 to 15
DisplayLevel | Display a horizontal bar graph. Command e.g., `DisplayLevel 50` will display `[\|\|\|\|____]` on the 4-digit display | 0 to 100
DisplayClock | Displays a clock. <br> `DisplayClock 1` displays a clock in 12-hour format. <br> `DisplayClock 2` displays a clock in 24-hour format. <br> `DisplayClock 0` turns off the clock and clears the display  | 1 or 2 or 0
DisplaySetLEDs (TM1638 only) | Sets the 8 LEDs (not the digits!) on the **TM1638** module to the binary number <br> represented by the input bit_array. <br> For example, `DisplaySetLEDs 3` would light up the first and second LED (from left), because 3 => 00000011 | 0 to 255
DisplaySetLED | Sets a LED at a specified position to either _ON_ or _OFF_.  e.g., `DisplaySetLED 2, 1` would light up the 3rd LED (2 => 3rd position). <br> `position` can be `0` (left-most) to `NUM_DIGITS-1` (right-most) <br> `value` can be `0` or `1` | `position`, `value`
DisplayButtons | Causes the current state of the buttons/LEDs to be returned as a `STAT` message of the following form: <br>`stat/TM1638/RESULT = {"DisplayButtons": {"S1":<s1>, "S2":<s2>, "S3":<s3>, "S4":<s4>, "S5":<s5>, "S6":<s6>, "S7":<s7>, "S8":<s8>, "Array": [<s1>,<s2>,<s3>,<s4>,<s5>,<s6>,<s7>,<s8>], "Byte": <byte>}}` <br> where - <br> `<s1>, <s2>, ...` are the states of each of the buttons/LEDs, and <br> `<byte>` is the decimal representation of the bit-array that constitutes these states. <br><br> For example, if the 5th button is pressed to turn ON LED5, and the "DisplayButtons" command is issued, <br> the response `STAT` message will be: <br> `stat/TM1638/RESULT = {"DisplayButtons": {"S1":0, "S2":0, "S3":0, "S4":0, "S5":1, "S6":0, "S7":0, "S8":0, "Array": [0,0,0,0,1,0,0,0], "Byte": 16}}` <br> because 16 => 2^(5-1) | 
 | | 


<br><br>

## Button Functionality (TM1638 only):
When using the **TM1638** module, i.e, with `DisplayType 2`, the buttons on the _TM1638_ module can be used to toggle the corresponding LEDs. 

In addition, for each button press, a `STAT` message of the following form is sent:<br>

`stat/<Topic>/RESULT = {"TM1638_BUTTON<x>":<state>}`

where - <br>
`<x>` = button index (starting at 1) <br>
`<state>` = state of the corresponding LED. It can be `ON` or `OFF` 

For example, if `Button3` is pressed, `LED3` would light up and a `STAT` message is sent as follows:

`stat/TM1638/RESULT = {"TM1638_BUTTON3":"ON"}`

<br>

Pressing `Button3` again would turn _OFF_ `LED3` and a `STAT` message is sent as follows:

`stat/TM1638/RESULT = {"TM1638_BUTTON3":"OFF"}`

<br><br>

## TM1637 Images

<br>
The TM1637 4-digit module (back and front):<br><br>

![TM1637](_media/peripherals/TM1637-back-and-front.jpg)

